<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #ff8c00 0%, #FFB500 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: 300;
            margin-bottom: 20px;
        }
        
        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn-rules {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(5px);
        }
        
        .btn-rules:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .content {
            padding: 40px 30px;
        }
        
        .products-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card.important {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .summary-card.important-2 {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .summary-card.important-3 {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .summary-card.important .summary-number,
        .summary-card.important-2 .summary-number,
        .summary-card.important-3 .summary-number {
            color: white;
        }
        
        .summary-number {
            font-size: 3.5em;
            font-weight: 800;
            color: #ffc73f;
            margin: 15px 0;
        }
        
        .summary-label {
            font-size: 1.3em;
            color: #555;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .summary-card.important .summary-label,
        .summary-card.important-2 .summary-label,
        .summary-card.important-3 .summary-label {
            color: rgba(255,255,255,0.9);
        }
        
        .summary-subtitle {
            font-size: 0.9em;
            color: #777;
            margin-top: 10px;
        }
        
        .summary-card.important .summary-subtitle,
        .summary-card.important-2 .summary-subtitle,
        .summary-card.important-3 .summary-subtitle {
            color: rgba(255,255,255,0.9);
        }
        
        .files-table-container {
            margin: 40px 0;
            overflow-x: auto;
        }
        
        .section-title {
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.2em;
        }
        
        .files-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .files-table th {
            background: linear-gradient(90deg, #b99131 0%, #ffb500 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .files-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            color: #333;
        }
        
        .files-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .files-table tr:hover {
            background-color: #e9ecef;
        }
        
        .file-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-in-progress {
            background-color: #cce5ff;
            color: #004085;
        }
        
        .status-available {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .urgency-high {
            background-color: #f8d7da;
            color: #721c24;
            font-weight: bold;
        }
        
        .urgency-medium {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .urgency-low {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .chart-container {
            margin: 50px 0;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .chart-title {
            color: #333;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .chart-subtitle {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            width: 100%;
        }
        
        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #555;
        }
        
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: linear-gradient(90deg, #ff8c00 0%, #FFB500 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .loading {
            text-align: center;
            padding: 60px 40px;
            font-size: 1.2em;
            color: #666;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #ffc107;
            margin: 20px 0;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #28a745;
            margin: 20px 0;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .error {
            background-color: #ffe6e6;
            color: #cc0000;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #cc0000;
            margin: 20px 0;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .date-cell {
            font-size: 0.9em;
            color: #666;
            white-space: nowrap;
        }
        
        .last-update {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            border-radius: 15px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }
        
        .modal-header {
            background: linear-gradient(90deg, #667eea 0%, #FFB500 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.8em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(80vh - 100px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(50px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            header {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2.2em;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            .summary-number {
                font-size: 2.5em;
            }
            
            .products-summary {
                grid-template-columns: 1fr;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .btn, .btn-rules {
                padding: 12px 25px;
                font-size: 1em;
                width: 100%;
                justify-content: center;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .header-buttons {
                flex-direction: column;
            }
            
            .files-table th, .files-table td {
                padding: 10px 8px;
                font-size: 0.9em;
            }
            
            .modal-content {
                width: 95%;
                max-height: 90vh;
            }
            
            .modal-header {
                padding: 20px;
            }
            
            .modal-title {
                font-size: 1.5em;
            }
            
            .modal-body {
                padding: 20px;
                max-height: calc(90vh - 80px);
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="rulesModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-book"></i> –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã
                </div>
                <button class="modal-close" onclick="closeRulesModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="rules-content">
                    <h2>–ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –æ—Ç–¥–µ–ª–∞ –∏ –æ—Ç–¥–µ–ª–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º–µ—Ä—Ü–∏–∏</h2>
                    <h2><b>–í—ã–≤–æ–¥ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç</b></h2>
                    <p style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;">
                        <i class="fas fa-info-circle"></i> <strong>–í–∞–∂–Ω–æ:</strong> –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1><i class="fas fa-chart-pie"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç</h1>
            <div class="subtitle">–û—á–µ—Ä–µ–¥—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>
        
            <div class="header-buttons">
                <button class="btn-rules" onclick="openRulesModal()">
                    <i class="fas fa-book"></i> –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã
                </button>
            </div>
        </header>
        
        <div class="content">
            <div id="warningMessage" class="warning" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ. –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å".
            </div>
            
            <div id="successMessage" class="success-message">
                <i class="fas fa-check-circle"></i> –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!
            </div>
            
            <div id="loading" class="loading">
                <i class="fas fa-spinner fa-spin fa-2x pulse"></i>
                <p style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –ª–∏—Å—Ç–æ–≤ "üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú" –∏ "–†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞"...</p>
                <p style="margin-top: 10px; font-size: 0.9em; color: #888;">
                    <i class="fas fa-info-circle"></i> –ê–Ω–∞–ª–∏–∑ —Å —É—á–µ—Ç–æ–º –¥–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
                </p>
            </div>
            
            <div id="statsSection" style="display: none;">
                <div class="products-summary">
                    <div class="summary-card important">
                        <div class="summary-label">
                            <i class="fas fa-user-tie"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                        </div>
                        <div class="summary-number" id="managerProductsToAdd">0</div>
                        <div class="summary-subtitle">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ" —Å –ª–∏—Å—Ç–∞ "üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú"</div>
                    </div>
                    
                    <div class="summary-card important-2">
                        <div class="summary-label">
                            <i class="fas fa-file-alt"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                        </div>
                        <div class="summary-number" id="contentProductsToAdd">0</div>
                        <div class="summary-subtitle">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ" —Å –ª–∏—Å—Ç–∞ "–†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞"</div>
                    </div>
                    
                    <div class="summary-card important-3">
                        <div class="summary-label">
                            <i class="fas fa-check-circle"></i> –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                        </div>
                        <div class="summary-number" id="productsAddedThisMonth">0</div>
                        <div class="summary-subtitle">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–ó–∞–≤–µ—Ä—à–µ–Ω–æ" –∏–∑ –æ–±–æ–∏—Ö –ª–∏—Å—Ç–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ</div>
                    </div>
                </div>
                
                <div class="files-table-container">
                    <h2 class="section-title">
                        <i class="fas fa-user-tie"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞
                    </h2>
                    
                    <table class="files-table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-file"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</th>
                                <th><i class="fas fa-boxes"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞</th>
                                <th><i class="fas fa-calendar-plus"></i> –î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ñ–∞–π–ª–∞ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞</th>
                                <th><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å</th>
                                <th><i class="fas fa-exclamation-triangle"></i> –°—Ä–æ—á–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody id="managerFilesTableBody">
                        </tbody>
                    </table>
                    <div class="last-update" style="margin-top: 15px; text-align: center;">
                        <i class="fas fa-info-circle"></i> –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ". –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–∫—Ä—ã—Ç—ã.
                    </div>
                </div>
                
                <div class="files-table-container">
                    <h2 class="section-title">
                        <i class="fas fa-file-alt"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    </h2>
                    
                    <table class="files-table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-file"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</th>
                                <th><i class="fas fa-boxes"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞</th>
                                <th><i class="fas fa-calendar-plus"></i> –î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ñ–∞–π–ª–∞ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞</th>
                                <th><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å</th>
                                <th><i class="fas fa-exclamation-triangle"></i> –°—Ä–æ—á–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody id="contentFilesTableBody">
                        </tbody>
                    </table>
                    <div class="last-update" style="margin-top: 15px; text-align: center;">
                        <i class="fas fa-info-circle"></i> –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ". –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–∫—Ä—ã—Ç—ã.
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">
                                <i class="fas fa-chart-bar"></i> –î–∏–Ω–∞–º–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –º–µ—Å—è—Ü–∞–º
                            </div>
                            <div class="chart-subtitle">
                                –°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ "–í—ã–ø–æ–ª–Ω–µ–Ω–æ" –ø–æ –º–µ—Å—è—Ü–∞–º –∏–∑ –æ–±–æ–∏—Ö –ª–∏—Å—Ç–æ–≤
                            </div>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            <i class="fas fa-calendar-alt"></i> 
                            <span id="chartPeriod">–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
                        </div>
                    </div>
                    
                    <div class="chart-wrapper">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    
                    <div class="chart-legend" id="chartLegend">
                    </div>
                    
                    <div class="last-update" style="text-align: center; margin-top: 15px;">
                        <i class="fas fa-info-circle"></i> –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: <span id="chartUpdateTime">-</span>
                    </div>
                </div>
                
                <div class="buttons">
                    <button onclick="loadData(true)" class="btn">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // ID Google –¢–∞–±–ª–∏—Ü
        const MANAGER_SPREADSHEET_ID = '120MzlbbGmHqroutPw5EtvfkTdDf4RMGbf72CV_K7IeE';
        const MANAGER_SHEET_NAME = 'üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú';
        
        const CONTENT_SPREADSHEET_ID = '2PACX-1vT2AYh3Iqgf07HInfdc3bQwE_L3AweAonhdE7LlJlJtBHo_5rx3WVko0Pdm5eGjCvmcjTOWja8nP20O';
        const CONTENT_SHEET_NAME = '–†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞';
        
        // –ù–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        const STATUS_COLUMN_NAMES = ['–°—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã', '–°—Ç–∞—Ç—É—Å', '–°—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞', '–°–æ—Å—Ç–æ—è–Ω–∏–µ'];
        const PRODUCTS_COLUMN_NAMES = ['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤', '–¢–æ–≤–∞—Ä—ã', '–ö–æ–ª-–≤–æ —Ç–æ–≤–∞—Ä–æ–≤', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'];
        const FILENAME_COLUMN_NAMES = ['–ò–º—è —Ñ–∞–π–ª–∞', '–§–∞–π–ª', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞', 'File name'];
        const COMPLETION_DATE_COLUMN_NAMES = ['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã', '–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è', '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è', 'Completion date'];
        const ADDITION_DATE_COLUMN_NAMES = ['–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞', '–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è', '–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'Upload date', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è'];
        const URGENCY_COLUMN_NAMES = ['–°—Ä–æ—á–Ω–æ—Å—Ç—å', '–°—Ä–æ—á–Ω–æ', '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç', 'Urgency'];
        
        // –≠–º–æ–¥–∂–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
        const EMOJI_STATUSES = {
            'üÜï': 'available',
            '‚úÖ': 'completed',
            'üîÑ': 'in_progress'
        };
        
        const MONTH_NAMES_RU = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                               '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
        let monthlyChart = null;
        let currentMonth, currentYear;
        
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        let managerProductsToAdd = 0;
        let contentProductsToAdd = 0;
        let productsAddedThisMonth = 0;
        
        // –ú–∞—Å—Å–∏–≤—ã –¥–ª—è —Ñ–∞–π–ª–æ–≤
        let managerFilesForProcessing = [];
        let contentFilesForProcessing = [];
        let monthlyData = [];
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function openRulesModal() {
            document.getElementById('rulesModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closeRulesModal() {
            document.getElementById('rulesModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        document.getElementById('rulesModal').addEventListener('click', function(e) {
            if (e.target === this) closeRulesModal();
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeRulesModal();
        });
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function loadData(forceLoad = false) {
            const loading = document.getElementById('loading');
            const statsSection = document.getElementById('statsSection');
            
            loading.style.display = 'block';
            statsSection.style.display = 'none';
            
            try {
                // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
                resetData();
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –≥–æ–¥
                const currentDate = new Date();
                currentMonth = currentDate.getMonth();
                currentYear = currentDate.getFullYear();
                
                const monthlyTotals = {};
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü
                await loadManagerData(monthlyTotals);
                await loadContentData(monthlyTotals);
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
                prepareMonthlyData(monthlyTotals);
                
                updateDisplay();
                
                loading.style.display = 'none';
                statsSection.style.display = 'block';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                loading.style.display = 'none';
                showDemoData();
            }
        }
        
        // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
        function resetData() {
            managerProductsToAdd = 0;
            contentProductsToAdd = 0;
            productsAddedThisMonth = 0;
            managerFilesForProcessing = [];
            contentFilesForProcessing = [];
            monthlyData = [];
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
        async function loadManagerData(monthlyTotals) {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å –ª–∏—Å—Ç–∞:', MANAGER_SHEET_NAME);
                
                // –î–ª—è Google Sheets API v4
                const apiKey = 'AIzaSyDyJppAwJkyLm-Mt8cYqy5xPJt6jiI1oJo';
                const range = encodeURIComponent(MANAGER_SHEET_NAME);
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${MANAGER_SPREADSHEET_ID}/values/${range}?key=${apiKey}`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤: ${response.status}`);
                }
                
                const data = await response.json();
                if (!data.values || data.values.length === 0) {
                    throw new Error('–¢–∞–±–ª–∏—Ü–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø—É—Å—Ç–∞');
                }
                
                const rows = data.values;
                const headers = rows[0];
                
                // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å—ã —Å—Ç–æ–ª–±—Ü–æ–≤
                const columnIndices = findColumnIndices(headers);
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏
                for (let i = 1; i < rows.length; i++) {
                    const rowData = rows[i];
                    if (rowData.length === 0) continue;
                    
                    processRowData(rowData, columnIndices, monthlyTotals, 'manager');
                }
                
                console.log('–î–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', {
                    filesCount: managerFilesForProcessing.length,
                    productsToAdd: managerProductsToAdd
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:', error);
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        async function loadContentData(monthlyTotals) {
            try {
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞...');
                
                // –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏—Å–ø–æ–ª—å–∑—É–µ–º CSV —ç–∫—Å–ø–æ—Ä—Ç
                const csvUrl = `https://docs.google.com/spreadsheets/d/e/${CONTENT_SPREADSHEET_ID}/pub?output=csv`;
                
                const response = await fetch(csvUrl);
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${response.status}`);
                
                const csvText = await response.text();
                const rows = csvText.split('\n').filter(row => row.trim() !== '');
                
                if (rows.length < 2) {
                    console.log('–¢–∞–±–ª–∏—Ü–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞');
                    return;
                }
                
                const headers = parseCSVRow(rows[0]);
                const columnIndices = findColumnIndices(headers);
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏
                for (let i = 1; i < rows.length; i++) {
                    const rowData = parseCSVRow(rows[i]);
                    if (rowData.length === 0) continue;
                    
                    processRowData(rowData, columnIndices, monthlyTotals, 'content');
                }
                
                console.log('–î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', {
                    filesCount: contentFilesForProcessing.length,
                    productsToAdd: contentProductsToAdd
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', error);
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            }
        }
        
        // –ü–æ–∏—Å–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—Ç–æ–ª–±—Ü–æ–≤
        function findColumnIndices(headers) {
            return {
                status: findColumnIndex(headers, STATUS_COLUMN_NAMES),
                products: findColumnIndex(headers, PRODUCTS_COLUMN_NAMES),
                filename: findColumnIndex(headers, FILENAME_COLUMN_NAMES),
                completionDate: findColumnIndex(headers, COMPLETION_DATE_COLUMN_NAMES),
                additionDate: findColumnIndex(headers, ADDITION_DATE_COLUMN_NAMES),
                urgency: findColumnIndex(headers, URGENCY_COLUMN_NAMES)
            };
        }
        
        // –ü–æ–∏—Å–∫ –∏–Ω–¥–µ–∫—Å–∞ —Å—Ç–æ–ª–±—Ü–∞
        function findColumnIndex(headers, columnNames) {
            for (const columnName of columnNames) {
                const index = headers.findIndex(header => 
                    header && header.trim().toLowerCase().includes(columnName.toLowerCase())
                );
                
                if (index !== -1) return index;
            }
            return -1;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        function processRowData(rowData, columnIndices, monthlyTotals, source) {
            const analysis = analyzeRow(rowData, columnIndices);
            
            if (!analysis.filename) return;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –µ—Å–ª–∏ –Ω–µ "–∑–∞–≤–µ—Ä—à–µ–Ω–æ"
            if (analysis.statusType !== 'completed') {
                const fileData = {
                    filename: analysis.filename,
                    productsCount: analysis.productsCount,
                    status: analysis.status,
                    statusType: analysis.statusType,
                    additionDate: analysis.additionDateFormatted,
                    urgency: analysis.urgency,
                    urgencyClass: getUrgencyClass(analysis.urgency)
                };
                
                if (source === 'manager') {
                    managerFilesForProcessing.push(fileData);
                } else {
                    contentFilesForProcessing.push(fileData);
                }
            }
            
            // –°—á–∏—Ç–∞–µ–º —Ç–æ–≤–∞—Ä—ã –¥–ª—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
            if (analysis.statusType === 'completed') {
                if (analysis.isCurrentMonth) {
                    productsAddedThisMonth += analysis.productsCount;
                }
                
                if (analysis.completionMonth) {
                    if (!monthlyTotals[analysis.completionMonth]) {
                        monthlyTotals[analysis.completionMonth] = 0;
                    }
                    monthlyTotals[analysis.completionMonth] += analysis.productsCount;
                }
            } else {
                if (source === 'manager') {
                    managerProductsToAdd += analysis.productsCount;
                } else {
                    contentProductsToAdd += analysis.productsCount;
                }
            }
        }
        
        // –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–æ–∫–∏
        function analyzeRow(rowData, columnIndices) {
            const result = {
                status: '',
                statusType: 'unknown',
                productsCount: 0,
                filename: '',
                completionMonth: null,
                additionDateFormatted: '',
                urgency: '',
                isCurrentMonth: false
            };
            
            // –°—Ç–∞—Ç—É—Å
            if (columnIndices.status !== -1 && rowData[columnIndices.status]) {
                result.status = rowData[columnIndices.status].toString().trim();
                result.statusType = determineStatusType(result.status);
            }
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
            if (columnIndices.products !== -1 && rowData[columnIndices.products]) {
                const productsStr = rowData[columnIndices.products].toString().trim();
                const cleanedStr = productsStr.replace(/[^\d.,]/g, '');
                const normalizedStr = cleanedStr.replace(',', '.');
                result.productsCount = parseFloat(normalizedStr) || 0;
            }
            
            // –ò–º—è —Ñ–∞–π–ª–∞
            if (columnIndices.filename !== -1 && rowData[columnIndices.filename]) {
                result.filename = rowData[columnIndices.filename].toString().trim();
            }
            
            // –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            if (columnIndices.additionDate !== -1 && rowData[columnIndices.additionDate]) {
                const dateStr = rowData[columnIndices.additionDate].toString().trim();
                result.additionDateFormatted = formatDate(dateStr);
            }
            
            // –°—Ä–æ—á–Ω–æ—Å—Ç—å
            if (columnIndices.urgency !== -1 && rowData[columnIndices.urgency]) {
                result.urgency = rowData[columnIndices.urgency].toString().trim();
            }
            
            // –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            if (columnIndices.completionDate !== -1 && rowData[columnIndices.completionDate]) {
                const dateStr = rowData[columnIndices.completionDate].toString().trim();
                if (dateStr) {
                    try {
                        const dateOnly = dateStr.split(' ')[0];
                        const parts = dateOnly.split('.');
                        
                        if (parts.length === 3) {
                            const day = parseInt(parts[0], 10);
                            const month = parseInt(parts[1], 10) - 1;
                            const year = parseInt(parts[2], 10);
                            
                            if (!isNaN(day) && !isNaN(month) && !isNaN(year)) {
                                result.isCurrentMonth = (month === currentMonth && year === currentYear);
                                const monthName = MONTH_NAMES_RU[month];
                                result.completionMonth = `${monthName} ${year}`;
                            }
                        }
                    } catch (e) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É:', dateStr, e);
                    }
                }
            }
            
            return result;
        }
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Ç–∞—Ç—É—Å–∞
        function determineStatusType(status) {
            if (!status) return 'unknown';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–º–æ–¥–∂–∏
            const emoji = getFirstEmoji(status);
            if (emoji && emoji in EMOJI_STATUSES) {
                return EMOJI_STATUSES[emoji];
            }
            
            const statusLower = status.toLowerCase();
            if (statusLower.includes('–∑–∞–≤–µ—Ä—à') || statusLower.includes('–≤—ã–ø–æ–ª–Ω') || statusLower.includes('–≥–æ—Ç–æ–≤')) {
                return 'completed';
            } else if (statusLower.includes('–¥–æ—Å—Ç—É–ø')) {
                return 'available';
            } else if (statusLower.includes('—Ä–∞–±–æ—Ç')) {
                return 'in_progress';
            }
            
            return 'unknown';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —ç–º–æ–¥–∂–∏
        function getFirstEmoji(text) {
            if (!text) return '';
            const emojiRegex = /[\p{Emoji}]/u;
            const match = text.match(emojiRegex);
            return match ? match[0] : '';
        }
        
        // –ö–ª–∞—Å—Å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
        function getUrgencyClass(urgencyText) {
            if (!urgencyText) return 'urgency-low';
            
            const urgencyLower = urgencyText.toLowerCase();
            
            if (urgencyLower.includes('–≤—ã—Å–æ–∫') || urgencyLower.includes('—Å—Ä–æ—á–Ω') || urgencyLower.includes('urgent') || urgencyLower.includes('high')) {
                return 'urgency-high';
            } else if (urgencyLower.includes('—Å–µ–∑–æ–Ω') || urgencyLower.includes('medium') || urgencyLower.includes('normal')) {
                return 'urgency-medium';
            } else {
                return 'urgency-low';
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            if (!dateString || dateString.trim() === '') {
                return '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            }
            
            try {
                const dateStr = dateString.trim();
                
                // –§–æ—Ä–º–∞—Ç DD.MM.YYYY
                const parts1 = dateStr.split('.');
                if (parts1.length >= 3) {
                    const day = parseInt(parts1[0], 10);
                    const month = parseInt(parts1[1], 10) - 1;
                    const yearPart = parts1[2].split(' ')[0];
                    const year = parseInt(yearPart, 10);
                    
                    if (!isNaN(day) && !isNaN(month) && !isNaN(year)) {
                        const date = new Date(year, month, day);
                        return date.toLocaleDateString('ru-RU', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric'
                        });
                    }
                }
                
                // –§–æ—Ä–º–∞—Ç YYYY-MM-DD
                const parts2 = dateStr.split('-');
                if (parts2.length >= 3) {
                    const year = parseInt(parts2[0], 10);
                    const month = parseInt(parts2[1], 10) - 1;
                    const day = parseInt(parts2[2].split(' ')[0], 10);
                    
                    if (!isNaN(day) && !isNaN(month) && !isNaN(year)) {
                        const date = new Date(year, month, day);
                        return date.toLocaleDateString('ru-RU', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric'
                        });
                    }
                }
                
                return dateStr;
            } catch (e) {
                return dateString;
            }
        }
        
        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
        function prepareMonthlyData(monthlyTotals) {
            monthlyData = Object.keys(monthlyTotals)
                .map(monthKey => ({
                    month: monthKey,
                    total: monthlyTotals[monthKey]
                }))
                .sort((a, b) => {
                    const parseMonth = (str) => {
                        const [monthStr, yearStr] = str.split(' ');
                        const monthIndex = MONTH_NAMES_RU.indexOf(monthStr);
                        const year = parseInt(yearStr);
                        return new Date(year, monthIndex);
                    };
                    return parseMonth(a.month) - parseMonth(b.month);
                });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function updateDisplay() {
            updateSummaryCards();
            updateManagerFilesTable();
            updateContentFilesTable();
            updateChart();
            animateNumbers();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
        function updateSummaryCards() {
            document.getElementById('managerProductsToAdd').textContent = managerProductsToAdd;
            document.getElementById('contentProductsToAdd').textContent = contentProductsToAdd;
            document.getElementById('productsAddedThisMonth').textContent = productsAddedThisMonth;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
        function updateManagerFilesTable() {
            const tableBody = document.getElementById('managerFilesTableBody');
            tableBody.innerHTML = '';
            
            if (managerFilesForProcessing.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-info-circle"></i> –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                        </td>
                    </tr>
                `;
                return;
            }
            
            managerFilesForProcessing.forEach(file => {
                const statusClass = `status-${file.statusType}`;
                const statusText = getStatusText(file.statusType);
                const urgencyClass = file.urgencyClass || 'urgency-low';
                const urgencyText = file.urgency || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${file.filename || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</strong></td>
                    <td><span class="highlight">${file.productsCount}</span> —Ç–æ–≤–∞—Ä–æ–≤</td>
                    <td class="date-cell">${file.additionDate}</td>
                    <td><span class="file-status ${statusClass}">${statusText}</span></td>
                    <td><span class="file-status ${urgencyClass}">${urgencyText}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function updateContentFilesTable() {
            const tableBody = document.getElementById('contentFilesTableBody');
            tableBody.innerHTML = '';
            
            if (contentFilesForProcessing.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-info-circle"></i> –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                        </td>
                    </tr>
                `;
                return;
            }
            
            contentFilesForProcessing.forEach(file => {
                const statusClass = `status-${file.statusType}`;
                const statusText = getStatusText(file.statusType);
                const urgencyClass = file.urgencyClass || 'urgency-low';
                const urgencyText = file.urgency || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${file.filename || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</strong></td>
                    <td><span class="highlight">${file.productsCount}</span> —Ç–æ–≤–∞—Ä–æ–≤</td>
                    <td class="date-cell">${file.additionDate}</td>
                    <td><span class="file-status ${statusClass}">${statusText}</span></td>
                    <td><span class="file-status ${urgencyClass}">${urgencyText}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
        function getStatusText(statusType) {
            switch(statusType) {
                case 'in_progress': return 'üîÑ –í —Ä–∞–±–æ—Ç–µ';
                case 'available': return 'üÜï –î–æ—Å—Ç—É–ø–Ω–æ';
                case 'completed': return '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                default: return '‚ùì –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            if (monthlyChart) {
                monthlyChart.destroy();
            }
            
            const labels = monthlyData.map(item => item.month);
            const data = monthlyData.map(item => item.total);
            
            const chartPeriod = document.getElementById('chartPeriod');
            if (labels.length > 0) {
                chartPeriod.textContent = `–ü–µ—Ä–∏–æ–¥: ${labels[0]} - ${labels[labels.length - 1]}`;
            } else {
                chartPeriod.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥';
            }
            
            document.getElementById('chartUpdateTime').textContent = new Date().toLocaleString('ru-RU');
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–¢–æ–≤–∞—Ä–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ',
                        data: data,
                        backgroundColor: labels.map((_, index) => {
                            const hue = 200 + (index * 30) % 155;
                            return `hsla(${hue}, 70%, 60%, 0.8)`;
                        }),
                        borderColor: labels.map((_, index) => {
                            const hue = 200 + (index * 30) % 155;
                            return `hsla(${hue}, 70%, 50%, 1)`;
                        }),
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `–¢–æ–≤–∞—Ä–æ–≤: ${context.parsed.y.toLocaleString('ru-RU')}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '–ú–µ—Å—è—Ü –∏ –≥–æ–¥',
                                font: { size: 14, weight: 'bold' }
                            }
                        }
                    }
                }
            });
            
            updateChartLegend();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã –≥—Ä–∞—Ñ–∏–∫–∞
        function updateChartLegend() {
            const legendContainer = document.getElementById('chartLegend');
            
            if (monthlyData.length === 0) {
                legendContainer.innerHTML = '<div class="legend-item"><i class="fas fa-info-circle"></i> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            let legendHTML = '';
            monthlyData.forEach((item, index) => {
                const hue = 200 + (index * 30) % 155;
                const color = `hsl(${hue}, 70%, 60%)`;
                
                legendHTML += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: ${color};"></div>
                        <span>${item.month}: <strong>${item.total}</strong> —Ç–æ–≤–∞—Ä–æ–≤</span>
                    </div>
                `;
            });
            
            legendContainer.innerHTML = legendHTML;
        }
        
        // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
        function animateNumbers() {
            const numbers = document.querySelectorAll('.summary-number');
            numbers.forEach(number => {
                number.classList.add('pulse');
                setTimeout(() => number.classList.remove('pulse'), 1000);
            });
        }
        
        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
        function showDemoData() {
            const loading = document.getElementById('loading');
            const statsSection = document.getElementById('statsSection');
            const warningMessage = document.getElementById('warningMessage');
            
            const currentDate = new Date();
            currentMonth = currentDate.getMonth();
            currentYear = currentDate.getFullYear();
            
            managerProductsToAdd = 85;
            contentProductsToAdd = 45;
            productsAddedThisMonth = 42;
            
            managerFilesForProcessing = [
                { filename: '–ö–∞—Ç–∞–ª–æ–≥_–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤_1.xlsx', productsCount: 25, statusType: 'in_progress', 
                  additionDate: '15.03.2024', urgency: '–í—ã—Å–æ–∫–∞—è', urgencyClass: 'urgency-high' },
                { filename: '–ö–∞—Ç–∞–ª–æ–≥_–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤_2.xlsx', productsCount: 30, statusType: 'available', 
                  additionDate: '22.03.2024', urgency: '–°—Ä–µ–¥–Ω—è—è', urgencyClass: 'urgency-medium' },
                { filename: '–ö–∞—Ç–∞–ª–æ–≥_–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤_3.xlsx', productsCount: 20, statusType: 'in_progress', 
                  additionDate: '28.03.2024', urgency: '–ù–∏–∑–∫–∞—è', urgencyClass: 'urgency-low' }
            ];
            
            contentFilesForProcessing = [
                { filename: '–ö–æ–Ω—Ç–µ–Ω—Ç_1.xlsx', productsCount: 15, statusType: 'in_progress', 
                  additionDate: '10.03.2024', urgency: '–í—ã—Å–æ–∫–∞—è', urgencyClass: 'urgency-high' },
                { filename: '–ö–æ–Ω—Ç–µ–Ω—Ç_2.xlsx', productsCount: 20, statusType: 'available', 
                  additionDate: '18.03.2024', urgency: '–°—Ä–µ–¥–Ω—è—è', urgencyClass: 'urgency-medium' },
                { filename: '–ö–æ–Ω—Ç–µ–Ω—Ç_3.xlsx', productsCount: 10, statusType: 'in_progress', 
                  additionDate: '25.03.2024', urgency: '–ù–∏–∑–∫–∞—è', urgencyClass: 'urgency-low' }
            ];
            
            monthlyData = [
                { month: '–î–µ–∫–∞–±—Ä—å 2024', total: 88 },
                { month: '–Ø–Ω–≤–∞—Ä—å 2025', total: 72 },
                { month: '–§–µ–≤—Ä–∞–ª—å 2025', total: 109 },
                { month: '–ú–∞—Ä—Ç 2025', total: 96 },
                { month: `${MONTH_NAMES_RU[currentMonth]} ${currentYear}`, total: productsAddedThisMonth }
            ];
            
            updateDisplay();
            
            loading.style.display = 'none';
            statsSection.style.display = 'block';
            warningMessage.style.display = 'block';
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ CSV —Å—Ç—Ä–æ–∫–∏
        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                const nextChar = row[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current);
            return result.map(cell => cell.trim());
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
