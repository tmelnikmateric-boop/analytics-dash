<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-pie"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∞–π—Ç</h1>
            <div class="subtitle">–û—á–µ—Ä–µ–¥—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>
            <div class="data-source-info">
                <i class="fas fa-database"></i> –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: 
                <a href="https://docs.google.com/spreadsheets/d/1vCZQgzBPv8uahr8ckRI1f-TA_QS6Afz2B9NP_ZMj6ek/edit" 
                   target="_blank" style="color: #17a2b8; font-weight: 600;">
                   –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—á–∏—Ö –≥—Ä—É–ø–ø
                </a>
            </div>
        </header>
        
        <div class="content">
            <div id="warningMessage" class="warning" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i> <span id="warningText"></span>
            </div>
            
            <div id="errorMessage" class="error" style="display: none;">
                <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
            </div>
            
            <div id="loading" class="loading">
                <i class="fas fa-spinner fa-spin fa-2x"></i>
                <p style="margin-top: 15px;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
                <p id="loadingDetails" style="font-size: 0.9em; color: #888; margin-top: 5px;"></p>
            </div>
            
            <div id="statsSection" style="display: none;">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ -->
                <div class="products-summary">
                    <div class="summary-card important">
                        <div class="summary-label">
                            <i class="fas fa-user-tie"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                        </div>
                        <div class="summary-number" id="managerProductsToAdd">0</div>
                        <div class="summary-subtitle">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ" —Å –ª–∏—Å—Ç–∞ "üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú" (GID: 1367779997)</div>
                    </div>
                    
                    <div class="summary-card important-2">
                        <div class="summary-label">
                            <i class="fas fa-file-alt"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                        </div>
                        <div class="summary-number" id="contentProductsToAdd">0</div>
                        <div class="summary-subtitle">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ" —Å –ª–∏—Å—Ç–∞ "–†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞" (GID: 33531424)</div>
                    </div>
                    
                    <div class="summary-card important-3">
                        <div class="summary-label">
                            <i class="fas fa-check-circle"></i> –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                        </div>
                        <div class="summary-number" id="productsAddedThisMonth">0</div>
                        <div class="summary-subtitle">–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–ó–∞–≤–µ—Ä—à–µ–Ω–æ" –∏–∑ –æ–±–æ–∏—Ö –ª–∏—Å—Ç–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ</div>
                    </div>
                </div>
                
                <div class="files-table-container">
                    <h2 class="section-title">
                        <i class="fas fa-user-tie"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú)
                    </h2>
                    <div class="data-source-info">
                        <i class="fas fa-info-circle"></i> –ò—Å—Ç–æ—á–Ω–∏–∫: 
                        <a href="https://docs.google.com/spreadsheets/d/1vCZQgzBPv8uahr8ckRI1f-TA_QS6Afz2B9NP_ZMj6ek/edit?gid=1367779997" 
                           target="_blank" style="color: #17a2b8;">
                           –õ–∏—Å—Ç "üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú" (GID: 1367779997)
                        </a>
                        | –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å—ã "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ"
                    </div>
                    
                    <table class="files-table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-file"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</th>
                                <th><i class="fas fa-boxes"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤</th>
                                <th><i class="fas fa-calendar-plus"></i> –î–∞—Ç–∞ –≤–∑—è—Ç–∏—è</th>
                                <th><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã</th>
                                <th><i class="fas fa-exclamation-triangle"></i> –°—Ä–æ—á–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody id="managerFilesTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div class="files-table-container">
                    <h2 class="section-title">
                        <i class="fas fa-file-alt"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    </h2>
                    <div class="data-source-info">
                        <i class="fas fa-info-circle"></i> –ò—Å—Ç–æ—á–Ω–∏–∫: 
                        <a href="https://docs.google.com/spreadsheets/d/1vCZQgzBPv8uahr8ckRI1f-TA_QS6Afz2B9NP_ZMj6ek/edit?gid=33531424" 
                           target="_blank" style="color: #17a2b8;">
                           –õ–∏—Å—Ç "–†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞" (GID: 33531424)
                        </a>
                        | –¢–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å—ã "–í —Ä–∞–±–æ—Ç–µ" –∏ "–î–æ—Å—Ç—É–ø–Ω–æ"
                    </div>
                    
                    <table class="files-table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-file"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</th>
                                <th><i class="fas fa-boxes"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤</th>
                                <th><i class="fas fa-calendar-plus"></i> –î–∞—Ç–∞ –≤–∑—è—Ç–∏—è</th>
                                <th><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã</th>
                                <th><i class="fas fa-exclamation-triangle"></i> –°—Ä–æ—á–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody id="contentFilesTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div class="buttons">
                    <button onclick="loadRealData()" class="btn">
                        <i class="fas fa-sync-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    </button>
                    <button onclick="loadDataViaProxy()" class="btn" style="background: #28a745;">
                        <i class="fas fa-cloud-download-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
                    </button>
                    <button onclick="showDebugInfo()" class="btn" style="background: #6c757d;">
                        <i class="fas fa-bug"></i> –û—Ç–ª–∞–¥–∫–∞
                    </button>
                    <button onclick="clearData()" class="btn" style="background: #dc3545;">
                        <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                </div>
                
                <div id="debugSection" class="debug-info" style="display: none;">
                    <h4><i class="fas fa-bug"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:</h4>
                    <div id="debugContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–û–ù–°–¢–ê–ù–¢–´ –î–õ–Ø –¢–ê–ë–õ–ò–¶–´
        const SPREADSHEET_ID = '1vCZQgzBPv8uahr8ckRI1f-TA_QS6Afz2B9NP_ZMj6ek'; // –û—Å–Ω–æ–≤–Ω–æ–π ID —Ç–∞–±–ª–∏—Ü—ã
        
        // GID –ª–∏—Å—Ç–æ–≤
        const MANAGER_SHEET_GID = '1367779997';    // üë• –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –ö–ê–ú
        const CONTENT_SHEET_GID = '33531424';      // –†–∞–±–æ—á–∏–µ –≥—Ä—É–ø–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        
        // API –∫–ª—é—á (–ø—É–±–ª–∏—á–Ω—ã–π, —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è)
        const API_KEY = 'AIzaSyB2h6UGEU04ls1q4M-1t-MOBeL_9zHnF5s'; // Google Sheets API –∫–ª—é—á
        
        // –ü—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
        const PROXY_URL = 'https://cors-anywhere.herokuapp.com/';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
        let managerProductsToAdd = 0;
        let contentProductsToAdd = 0;
        let productsAddedThisMonth = 0;
        let managerFilesForProcessing = [];
        let contentFilesForProcessing = [];
        
        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        let debugLog = [];
        
        function logDebug(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            let logEntry = `[${timestamp}] ${message}`;
            
            if (data) {
                // –£–ø—Ä–æ—â–∞–µ–º –≤—ã–≤–æ–¥ –¥–ª–∏–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                if (typeof data === 'object' && data !== null) {
                    const simplifiedData = {};
                    for (const key in data) {
                        if (typeof data[key] === 'string' && data[key].length > 100) {
                            simplifiedData[key] = data[key].substring(0, 100) + '...';
                        } else {
                            simplifiedData[key] = data[key];
                        }
                    }
                    logEntry += `: ${JSON.stringify(simplifiedData, null, 2)}`;
                } else {
                    logEntry += `: ${data}`;
                }
            }
            
            debugLog.push(logEntry);
            console.log(logEntry);
        }
        
        function updateLoadingDetails(text) {
            const loadingDetails = document.getElementById('loadingDetails');
            if (loadingDetails) {
                loadingDetails.textContent = text;
            }
        }
        
        function showDebugInfo() {
            const debugSection = document.getElementById('debugSection');
            const debugContent = document.getElementById('debugContent');
            
            debugContent.innerHTML = debugLog.map(log => `<div style="margin-bottom: 5px; border-bottom: 1px solid #ddd; padding-bottom: 5px; font-family: monospace; font-size: 12px;">${log}</div>`).join('');
            debugSection.style.display = 'block';
        }
        
        function clearData() {
            managerProductsToAdd = 0;
            contentProductsToAdd = 0;
            productsAddedThisMonth = 0;
            managerFilesForProcessing = [];
            contentFilesForProcessing = [];
            
            updateDisplay();
            
            const warningMessage = document.getElementById('warningMessage');
            warningMessage.style.display = 'block';
            warningMessage.innerHTML = '<i class="fas fa-info-circle"></i> –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.';
            
            logDebug('–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
        }
        
        // –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò (—á–µ—Ä–µ–∑ Google Sheets API)
        async function loadRealData() {
            const loading = document.getElementById('loading');
            const statsSection = document.getElementById('statsSection');
            const warningMessage = document.getElementById('warningMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            loading.style.display = 'block';
            statsSection.style.display = 'none';
            warningMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            debugLog = [];
            logDebug('–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Google Sheets API');
            updateLoadingDetails('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ...');
            
            try {
                // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
                managerProductsToAdd = 0;
                contentProductsToAdd = 0;
                productsAddedThisMonth = 0;
                managerFilesForProcessing = [];
                contentFilesForProcessing = [];
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                updateLoadingDetails('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤...');
                logDebug('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å GID: ' + MANAGER_SHEET_GID);
                
                const managerData = await loadDataViaSheetsAPI(MANAGER_SHEET_GID, 'manager');
                
                if (managerData && managerData.length > 1) {
                    logDebug('–î–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', { 
                        rows: managerData.length,
                        sampleData: managerData.slice(0, 3)
                    });
                    processData(managerData, 'manager');
                } else {
                    logDebug('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏');
                    warningMessage.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É.';
                    warningMessage.style.display = 'block';
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                updateLoadingDetails('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞...');
                logDebug('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å GID: ' + CONTENT_SHEET_GID);
                
                const contentData = await loadDataViaSheetsAPI(CONTENT_SHEET_GID, 'content');
                
                if (contentData && contentData.length > 1) {
                    logDebug('–î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ', { 
                        rows: contentData.length,
                        sampleData: contentData.slice(0, 3)
                    });
                    processData(contentData, 'content');
                } else {
                    logDebug('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏');
                    if (!warningMessage.style.display || warningMessage.style.display === 'none') {
                        warningMessage.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É.';
                        warningMessage.style.display = 'block';
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateDisplay();
                
                loading.style.display = 'none';
                statsSection.style.display = 'block';
                updateLoadingDetails('');
                
                logDebug('–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ API –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', {
                    managerFiles: managerFilesForProcessing.length,
                    contentFiles: contentFilesForProcessing.length,
                    managerProducts: managerProductsToAdd,
                    contentProducts: contentProductsToAdd,
                    completedThisMonth: productsAddedThisMonth
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ API:', error);
                logDebug('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ API', { 
                    error: error.message,
                    stack: error.stack 
                });
                
                loading.style.display = 'none';
                errorMessage.style.display = 'block';
                document.getElementById('errorText').textContent = `–û—à–∏–±–∫–∞ Google Sheets API: ${error.message}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏.`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                showDemoData();
            }
        }
        
        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –ß–ï–†–ï–ó –ü–†–û–ö–°–ò (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥)
        async function loadDataViaProxy() {
            const loading = document.getElementById('loading');
            const statsSection = document.getElementById('statsSection');
            const warningMessage = document.getElementById('warningMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            loading.style.display = 'block';
            statsSection.style.display = 'none';
            warningMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            debugLog = [];
            logDebug('–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏');
            updateLoadingDetails('–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS...');
            
            try {
                // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
                managerProductsToAdd = 0;
                contentProductsToAdd = 0;
                productsAddedThisMonth = 0;
                managerFilesForProcessing = [];
                contentFilesForProcessing = [];
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
                const managerUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${MANAGER_SHEET_GID}`;
                const managerProxyUrl = PROXY_URL + managerUrl;
                
                updateLoadingDetails('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏...');
                logDebug('–ü—Ä–æ–∫—Å–∏ URL –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤', { url: managerProxyUrl });
                
                const managerData = await loadDataFromProxy(managerProxyUrl, 'manager');
                
                if (managerData && managerData.length > 1) {
                    logDebug('–î–∞–Ω–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –ø–æ–ª—É—á–µ–Ω—ã', { rows: managerData.length });
                    processData(managerData, 'manager');
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                const contentUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${CONTENT_SHEET_GID}`;
                const contentProxyUrl = PROXY_URL + contentUrl;
                
                updateLoadingDetails('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏...');
                logDebug('–ü—Ä–æ–∫—Å–∏ URL –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞', { url: contentProxyUrl });
                
                const contentData = await loadDataFromProxy(contentProxyUrl, 'content');
                
                if (contentData && contentData.length > 1) {
                    logDebug('–î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –ø–æ–ª—É—á–µ–Ω—ã', { rows: contentData.length });
                    processData(contentData, 'content');
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                updateDisplay();
                
                loading.style.display = 'none';
                statsSection.style.display = 'block';
                updateLoadingDetails('');
                
                if (managerFilesForProcessing.length === 0 && contentFilesForProcessing.length === 0) {
                    warningMessage.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –ß–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ.';
                    warningMessage.style.display = 'block';
                    showDemoData();
                } else {
                    warningMessage.innerHTML = '<i class="fas fa-check-circle"></i> –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏!';
                    warningMessage.style.display = 'block';
                    warningMessage.style.backgroundColor = '#d4edda';
                    warningMessage.style.color = '#155724';
                    warningMessage.style.borderLeftColor = '#c3e6cb';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏:', error);
                logDebug('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏', { error: error.message });
                
                loading.style.display = 'none';
                errorMessage.style.display = 'block';
                document.getElementById('errorText').textContent = `–û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏: ${error.message}. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ.`;
                
                showDemoData();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Google Sheets API v4
        async function loadDataViaSheetsAPI(gid, source) {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º Google Sheets API v4
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${gid}?key=${API_KEY}`;
                
                logDebug(`–ó–∞–≥—Ä—É–∂–∞–µ–º ${source} —á–µ—Ä–µ–∑ API`, { 
                    gid: gid,
                    urlShort: url.substring(0, 100) + '...'
                });
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    logDebug(`–û—à–∏–±–∫–∞ API –¥–ª—è ${source}`, {
                        status: response.status,
                        error: errorData
                    });
                    
                    throw new Error(`API –æ—à–∏–±–∫–∞ ${response.status}: ${errorData.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
                
                const data = await response.json();
                logDebug(`API –æ—Ç–≤–µ—Ç –¥–ª—è ${source}`, { 
                    hasData: !!data.values,
                    rowsCount: data.values ? data.values.length : 0
                });
                
                if (!data.values || data.values.length === 0) {
                    return [];
                }
                
                return data.values;
                
            } catch (error) {
                logDebug(`–û—à–∏–±–∫–∞ API –∑–∞–≥—Ä—É–∑–∫–∏ ${source}`, { error: error.message });
                throw error;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
        async function loadDataFromProxy(proxyUrl, source) {
            try {
                logDebug(`–ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å ${source} —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏`);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –ø—Ä–æ–∫—Å–∏
                const response = await fetch(proxyUrl, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`–ü—Ä–æ–∫—Å–∏ –æ—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                
                if (!csvText || csvText.trim() === '') {
                    logDebug(`–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –¥–ª—è ${source} —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏`);
                    return [];
                }
                
                // –ü–∞—Ä—Å–∏–º CSV
                const rows = parseCSV(csvText);
                logDebug(`–ü—Ä–æ–∫—Å–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –¥–ª—è ${source}`, { rows: rows.length });
                
                return rows;
                
            } catch (error) {
                logDebug(`–û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏ –∑–∞–≥—Ä—É–∑–∫–∏ ${source}`, { error: error.message });
                
                // –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±—É–µ–º –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø —Å –¥—Ä—É–≥–∏–º –ø–æ–¥—Ö–æ–¥–æ–º
                try {
                    logDebug(`–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è ${source}`);
                    return await loadDataAlternative(source);
                } catch (altError) {
                    logDebug(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è ${source}`, { error: altError.message });
                    return [];
                }
            }
        }
        
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)
        async function loadDataAlternative(source) {
            const gid = source === 'manager' ? MANAGER_SHEET_GID : CONTENT_SHEET_GID;
            
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã URL
            const urlFormats = [
                `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&gid=${gid}`,
                `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/pub?gid=${gid}&single=true&output=csv`,
                `https://docs.google.com/spreadsheets/d/e/2PACX-1vT2AYh3Iqgf07HInfdc3bQwE_L3AweAonhdE7LlJlJtBHo_5rx3WVko0Pdm5eGjCvmcjTOWja8nP20O/pub?gid=${gid}&single=true&output=csv`
            ];
            
            for (const url of urlFormats) {
                try {
                    logDebug(`–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL –¥–ª—è ${source}`, { url: url.substring(0, 100) + '...' });
                    
                    const response = await fetch(url);
                    if (response.ok) {
                        const csvText = await response.text();
                        const rows = parseCSV(csvText);
                        if (rows.length > 0) {
                            logDebug(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è ${source}`, { rows: rows.length });
                            return rows;
                        }
                    }
                } catch (error) {
                    logDebug(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª`, { url: url.substring(0, 50), error: error.message });
                }
            }
            
            throw new Error('–í—Å–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏');
        }
        
        // –ü–∞—Ä—Å–∏–Ω–≥ CSV (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function parseCSV(csvText) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < csvText.length; i++) {
                const char = csvText[i];
                const nextChar = csvText[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        currentField += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if (char === '\n' && !inQuotes) {
                    currentRow.push(currentField.trim());
                    rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                } else if (char === '\r') {
                    continue;
                } else {
                    currentField += char;
                }
            }
            
            if (currentField !== '' || currentRow.length > 0) {
                currentRow.push(currentField.trim());
                rows.push(currentRow);
            }
            
            return rows;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ)
        function processData(rows, source) {
            if (rows.length < 2) {
                logDebug(`–ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ${source}`, { rows: rows.length });
                return;
            }
            
            const headers = rows[0];
            logDebug(`–ó–∞–≥–æ–ª–æ–≤–∫–∏ ${source}`, headers);
            
            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å—ã —Å—Ç–æ–ª–±—Ü–æ–≤
            const indices = {
                status: findColumnIndex(headers, ['–°—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã', '–°—Ç–∞—Ç—É—Å', '–°–æ—Å—Ç–æ—è–Ω–∏–µ', '–°—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã']),
                products: findColumnIndex(headers, ['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', '–¢–æ–≤–∞—Ä—ã', '–ö–æ–ª-–≤–æ —Ç–æ–≤–∞—Ä–æ–≤']),
                filename: findColumnIndex(headers, ['–ò–º—è —Ñ–∞–π–ª–∞', '–§–∞–π–ª', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞']),
                date: findColumnIndex(headers, ['–î–∞—Ç–∞ –≤–∑—è—Ç–∏—è', '–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞', '–î–∞—Ç–∞', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è']),
                urgency: findColumnIndex(headers, ['–°—Ä–æ—á–Ω–æ—Å—Ç—å', '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç', '–í–∞–∂–Ω–æ—Å—Ç—å']),
                completionDate: findColumnIndex(headers, ['–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã', '–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è', '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è'])
            };
            
            logDebug(`–ò–Ω–¥–µ–∫—Å—ã —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è ${source}`, indices);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –≥–æ–¥
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if (row.length === 0) continue;
                
                const analysis = analyzeRow(row, indices, currentMonth, currentYear);
                
                if (analysis.filename && analysis.filename !== '') {
                    const fileData = {
                        filename: analysis.filename,
                        productsCount: analysis.productsCount,
                        status: analysis.status,
                        statusType: analysis.statusType,
                        additionDate: analysis.additionDate,
                        urgency: analysis.urgency,
                        urgencyClass: getUrgencyClass(analysis.urgency),
                        source: source
                    };
                    
                    if (source === 'manager') {
                        // –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤: —Ç–æ–ª—å–∫–æ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                        if (analysis.statusType !== 'completed' && analysis.statusType !== 'unknown') {
                            managerFilesForProcessing.push(fileData);
                            managerProductsToAdd += analysis.productsCount;
                        }
                        // –°—á–∏—Ç–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                        if (analysis.statusType === 'completed' && analysis.isCurrentMonth) {
                            productsAddedThisMonth += analysis.productsCount;
                        }
                    } else {
                        // –î–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞: —Ç–æ–ª—å–∫–æ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                        if (analysis.statusType !== 'completed' && analysis.statusType !== 'unknown') {
                            contentFilesForProcessing.push(fileData);
                            contentProductsToAdd += analysis.productsCount;
                        }
                        // –°—á–∏—Ç–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
                        if (analysis.statusType === 'completed' && analysis.isCurrentMonth) {
                            productsAddedThisMonth += analysis.productsCount;
                        }
                    }
                }
            }
            
            logDebug(`–û–±—Ä–∞–±–æ—Ç–∫–∞ ${source} –∑–∞–≤–µ—Ä—à–µ–Ω–∞`, {
                files: source === 'manager' ? managerFilesForProcessing.length : contentFilesForProcessing.length,
                products: source === 'manager' ? managerProductsToAdd : contentProductsToAdd
            });
        }
        
        // –ü–æ–∏—Å–∫ –∏–Ω–¥–µ–∫—Å–∞ —Å—Ç–æ–ª–±—Ü–∞
        function findColumnIndex(headers, columnNames) {
            if (!headers) return -1;
            
            for (const columnName of columnNames) {
                const index = headers.findIndex(header => 
                    header && header.toString().toLowerCase().includes(columnName.toLowerCase())
                );
                if (index !== -1) {
                    return index;
                }
            }
            
            return -1;
        }
        
        // –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä–æ–∫–∏
        function analyzeRow(row, indices, currentMonth, currentYear) {
            const result = {
                status: '',
                statusType: 'unknown',
                productsCount: 0,
                filename: '',
                additionDate: '–ù–µ —É–∫–∞–∑–∞–Ω–∞',
                urgency: '',
                isCurrentMonth: false
            };
            
            // –°—Ç–∞—Ç—É—Å
            if (indices.status !== -1 && row[indices.status]) {
                result.status = row[indices.status].toString().trim();
                result.statusType = determineStatusType(result.status);
            }
            
            // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
            if (indices.products !== -1 && row[indices.products]) {
                const str = row[indices.products].toString().trim();
                const num = parseFloat(str.replace(/[^\d.,]/g, '').replace(',', '.'));
                result.productsCount = isNaN(num) ? 0 : Math.round(num);
            }
            
            // –ò–º—è —Ñ–∞–π–ª–∞
            if (indices.filename !== -1 && row[indices.filename]) {
                result.filename = row[indices.filename].toString().trim();
            }
            
            // –î–∞—Ç–∞ –≤–∑—è—Ç–∏—è
            if (indices.date !== -1 && row[indices.date]) {
                const dateStr = row[indices.date].toString().trim();
                result.additionDate = formatDate(dateStr);
            }
            
            // –°—Ä–æ—á–Ω–æ—Å—Ç—å
            if (indices.urgency !== -1 && row[indices.urgency]) {
                result.urgency = row[indices.urgency].toString().trim();
                if (result.urgency === '') result.urgency = '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            }
            
            // –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞)
            if (indices.completionDate !== -1 && row[indices.completionDate]) {
                const dateStr = row[indices.completionDate].toString().trim();
                if (dateStr) {
                    try {
                        const dateOnly = dateStr.split(' ')[0];
                        const parts = dateOnly.split(/[\.\/-]/);
                        
                        if (parts.length === 3) {
                            const day = parseInt(parts[0], 10);
                            const month = parseInt(parts[1], 10) - 1;
                            const year = parts[2].length === 2 ? 2000 + parseInt(parts[2], 10) : parseInt(parts[2], 10);
                            
                            if (!isNaN(day) && !isNaN(month) && !isNaN(year)) {
                                result.isCurrentMonth = (month === currentMonth && year === currentYear);
                            }
                        }
                    } catch (e) {
                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã
                    }
                }
            }
            
            return result;
        }
        
        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å—Ç–∞—Ç—É—Å–∞
        function determineStatusType(status) {
            if (!status) return 'unknown';
            
            const statusLower = status.toLowerCase();
            
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —ç–º–æ–¥–∂–∏
            if (status.includes('‚úÖ') || status.includes('‚úî') || status.includes('‚úì') || 
                status.includes('‚òë') || status.includes('üéØ')) {
                return 'completed';
            }
            if (status.includes('üîÑ') || status.includes('‚öôÔ∏è') || status.includes('‚è≥') || 
                status.includes('üìä') || status.includes('üë®‚Äçüíª')) {
                return 'in_progress';
            }
            if (status.includes('üÜï') || status.includes('üìÑ') || status.includes('üìã') || 
                status.includes('üìÅ') || status.includes('üìÇ')) {
                return 'available';
            }
            
            // –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç
            if (statusLower.includes('–∑–∞–≤–µ—Ä—à') || statusLower.includes('–≤—ã–ø–æ–ª–Ω') || 
                statusLower.includes('–≥–æ—Ç–æ–≤') || statusLower.includes('—Å–¥–µ–ª–∞–Ω') ||
                statusLower.includes('done') || statusLower.includes('completed') ||
                statusLower.includes('–≥–æ—Ç–æ–≤–æ') || statusLower.includes('–∑–∞–∫—Ä—ã—Ç')) {
                return 'completed';
            } else if (statusLower.includes('–¥–æ—Å—Ç—É–ø') || statusLower.includes('–Ω–æ–≤') || 
                      statusLower.includes('–æ–∂–∏–¥–∞–Ω') || statusLower.includes('available') ||
                      statusLower.includes('–Ω–æ–≤–∞—è') || statusLower.includes('–æ–∂–∏–¥–∞–µ—Ç')) {
                return 'available';
            } else if (statusLower.includes('—Ä–∞–±–æ—Ç') || statusLower.includes('–≤ –ø—Ä–æ—Ü') || 
                      statusLower.includes('–æ–±—Ä–∞–±–æ—Ç') || statusLower.includes('in progress') ||
                      statusLower.includes('–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è') || statusLower.includes('–∞–∫—Ç–∏–≤')) {
                return 'in_progress';
            }
            
            return 'unknown';
        }
        
        // –ö–ª–∞—Å—Å —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
        function getUrgencyClass(urgencyText) {
            if (!urgencyText) return 'urgency-low';
            
            const urgencyLower = urgencyText.toLowerCase();
            if (urgencyLower.includes('–≤—ã—Å–æ–∫') || urgencyLower.includes('—Å—Ä–æ—á–Ω') || 
                urgencyLower.includes('urgent') || urgencyLower.includes('high') ||
                urgencyLower.includes('–∫—Ä–∏—Ç–∏—á') || urgencyLower.includes('–≤–∞–∂–Ω')) {
                return 'urgency-high';
            } else if (urgencyLower.includes('—Å–µ—Ä–µ–¥') || urgencyLower.includes('medium') || 
                      urgencyLower.includes('norm') || urgencyLower.includes('–æ–±—ã—á')) {
                return 'urgency-medium';
            } else {
                return 'urgency-low';
            }
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            if (!dateString || dateString.trim() === '') {
                return '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
            }
            
            try {
                const dateStr = dateString.trim();
                
                // –§–æ—Ä–º–∞—Ç DD.MM.YYYY –∏–ª–∏ DD/MM/YYYY
                const parts = dateStr.split(/[\.\/-]/);
                if (parts.length >= 3) {
                    const day = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10) - 1;
                    const year = parts[2].length === 2 ? 2000 + parseInt(parts[2], 10) : parseInt(parts[2], 10);
                    
                    if (!isNaN(day) && !isNaN(month) && !isNaN(year)) {
                        const date = new Date(year, month, day);
                        return date.toLocaleDateString('ru-RU');
                    }
                }
                
                // –ü—Ä–æ–±—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
                const parsedDate = new Date(dateStr);
                if (!isNaN(parsedDate.getTime())) {
                    return parsedDate.toLocaleDateString('ru-RU');
                }
                
                return dateStr;
            } catch (e) {
                return dateString;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function updateDisplay() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
            document.getElementById('managerProductsToAdd').textContent = managerProductsToAdd;
            document.getElementById('contentProductsToAdd').textContent = contentProductsToAdd;
            document.getElementById('productsAddedThisMonth').textContent = productsAddedThisMonth;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
            updateTable('managerFilesTableBody', managerFilesForProcessing, '–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            updateTable('contentFilesTableBody', contentFilesForProcessing, '–∫–æ–Ω—Ç–µ–Ω—Ç–∞');
            
            logDebug('–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        function updateTable(tableId, files, source) {
            const tableBody = document.getElementById(tableId);
            tableBody.innerHTML = '';
            
            if (files.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-info-circle"></i> –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ${source}
                        </td>
                    </tr>
                `;
                return;
            }
            
            files.forEach(file => {
                const statusClass = `status-${file.statusType.replace('_', '-')}`;
                const statusText = getStatusText(file.statusType);
                const urgencyClass = file.urgencyClass || 'urgency-low';
                const urgencyText = file.urgency || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${file.filename}</strong></td>
                    <td><span class="highlight">${file.productsCount}</span></td>
                    <td class="date-cell">${file.additionDate}</td>
                    <td><span class="file-status ${statusClass}">${statusText}</span></td>
                    <td><span class="file-status ${urgencyClass}">${urgencyText}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
        function getStatusText(statusType) {
            switch(statusType) {
                case 'in_progress': return 'üîÑ –í —Ä–∞–±–æ—Ç–µ';
                case 'available': return 'üÜï –î–æ—Å—Ç—É–ø–Ω–æ';
                case 'completed': return '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                default: return '‚ùì –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            }
        }
        
        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
        function showDemoData() {
            const loading = document.getElementById('loading');
            const statsSection = document.getElementById('statsSection');
            const warningMessage = document.getElementById('warningMessage');
            
            managerProductsToAdd = 85;
            contentProductsToAdd = 45;
            productsAddedThisMonth = 42;
            
            managerFilesForProcessing = [
                { filename: '–ö–∞—Ç–∞–ª–æ–≥_–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤_1.xlsx', productsCount: 25, statusType: 'in_progress', 
                  additionDate: '15.03.2024', urgency: '–í—ã—Å–æ–∫–∞—è', urgencyClass: 'urgency-high', source: 'manager' },
                { filename: '–ö–∞—Ç–∞–ª–æ–≥_–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤_2.xlsx', productsCount: 30, statusType: 'available', 
                  additionDate: '22.03.2024', urgency: '–°—Ä–µ–¥–Ω—è—è', urgencyClass: 'urgency-medium', source: 'manager' }
            ];
            
            contentFilesForProcessing = [
                { filename: '–ö–æ–Ω—Ç–µ–Ω—Ç_1.xlsx', productsCount: 15, statusType: 'in_progress', 
                  additionDate: '10.03.2024', urgency: '–í—ã—Å–æ–∫–∞—è', urgencyClass: 'urgency-high', source: 'content' },
                { filename: '–ö–æ–Ω—Ç–µ–Ω—Ç_2.xlsx', productsCount: 20, statusType: 'available', 
                  additionDate: '18.03.2024', urgency: '–°—Ä–µ–¥–Ω—è—è', urgencyClass: 'urgency-medium', source: 'content' }
            ];
            
            updateDisplay();
            
            loading.style.display = 'none';
            statsSection.style.display = 'block';
            warningMessage.style.display = 'block';
            warningMessage.innerHTML = '<i class="fas fa-exclamation-triangle"></i> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ. –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ø—Ä–æ–±—É–π—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏".';
            
            logDebug('–ü–æ–∫–∞–∑–∞–Ω—ã –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            logDebug('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            showDemoData();
        });
    </script>
</body>
</html>
